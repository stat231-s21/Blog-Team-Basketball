---
title: "NBA Connections"
author: "Emma Gardecki & Eric Ingram"
date: "Updated: May 2021"
output:
  rmdformats::readthedown:
    thumbnails: false
    highlight: NULL
runtime: shiny
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, fig.align="center")
library(tidyverse)
library(dplyr)
library(ggnetwork)
library(igraph)
library(ggiraph)
library(ggplot2)
library(plotly)
library(shiny)
library(shinythemes)
#import dataset
# path_in <- "/Users/emmagardecki/Documents/junior yr/stat231/Blog-Team-Basketball"
path_in_eric <- ""
# draft <- read_csv(paste0(path_in, "/draft_allplayers.csv"))
# players <- read_csv(paste0(path_in, "/allPlayers2010-2021.csv"))
draft <- read_csv(paste0(path_in_eric, "draft_allplayers.csv"))
players <- read_csv(paste0(path_in_eric, "allPlayers2010-2021.csv"))
#all teams
TEAMS0 <- c("ATL", "BOS", "NJN", "BKK", "CHA", "CHI", "CLE", "DAL", "DEN", "DET", "GSW", "HOU", "IND", "LAC", "LAL", "MEM", "MIA", "MIL", "MIN", "NOP", "NYK", "OKC", "ORL", "PHI", "PHX", "POR", "SAC", "SAS", "TOR", "UTA", "WAS", "CHO", "NOH")

#groups of players (from shiny)
#similar players,, been in the game 15 yrs 
p0 <- c("Rajon Rondo", "Kyle Lowry", "JJ Redick", "Paul Millsap", "LaMarcus Aldridge", "Rudy Gay")

#VORP >~ 40
pV <- c("Kevin Durant", "James Harden", "Russell Westbrook", "Stephen Curry", "Damian Lillard", "Anthony Davis", "Kyle Lowry")

#BPM >~ 5
pB <- c("Kevin Durant", "James Harden", "Russell Westbrook", "Stephen Curry", "Karl-Anthony Towns", "Kawhi Leonard", "Anthony Davis", "Grant Riller", "Robert Williams", "Kyrie Irving", "Joel Embiid")

#FGpct >~ 0.6
pFG <- c("Zion Williamson", "DeAndre Jordan", "Grant Riller", "Robert Williams", "Deytona Davis", "Jaxson Hayes", "Daniel Gafford", "Onyeka Okongwu", "Ryan Reid", "Tony Bradley", "Jarrett Allen", "Cheick Diallo", "Damien Jones", "Richaun Holmes", "Montrezi Harrell", "Brandon Wright")

#PTS >~ 25 pts/game
pP <- c("Kevin Durant", "James Harden", "Joel Embiid", "Zion Williamson", "Damian Lillard")

#TRB >~ 10
pR <- c("Andre Drummond", "Karl-Anthony Towns", "Joel Embiid", "DeAndre Jordan", "Anthony Davis", "Deandre Ayton", "Hassan Whiteside", "Nikola Vučević", "DeMarcus Cousins", "Kevin Love")
```




# Introduction
## Motivation
So much of a positive career is determined by the circumstances surrounding it. Maybe you got the job because you were in the right place at the right time, or you missed the interview because of a flat tire and didn't get the job. For players in the National Basketball Association, these circumstances are often experienced as what schools they attended and teams were they traded to. With this project we set out to discover if the circumstances around who players wore across their chests impacted overall career success. Did players that knew more players than others have more successful careers? Is connection early on in a basketball player's journey - say high school or college - more indicative of a successful career? 

Another question we set out to address is how do we measure success? We have decided to stick to the most quantitative measures of success, career statistics. Specifically, we are returning to the value over replacement player (VORP) statistic, but our visualizations allow for the user to choose the statistic they want to use to measure success by, from field goal percentage (FG%) to total number of rebounds (TRB). 

## Research Questions
* DOES CONNECTION EQUAL CAREER SUCCESS ? (measured in VORP)
* How connected are current NBA players?
* Is an early connection to NBA stars an indicator of career success?
 How do we measure success?

# Background
## Background on Topic


## Data Sources
The dataset we utilized for this investigation was scraped from basketball-reference.com. We scraped each team's roster from 2010-2021, which high school and college each player attended, and some relevant statistics for each player. 

# Findings
## Success
We begin our search for these answers by attempting to quantify player success through various (mostly offensive) game statistics. As mentioned above, the standard that we, as your authors and data scientists, chose to measure success by is VORP due to the fact it is a calculated statistic that attempts to weigh many simple stats. This algorithm, which is included in full in the Reference section, attempts to coerce basketball success into one simple number by weighing the perceived importance of various statistics (such as points per game (PPG) and total rebounds per game (TRB)) in addition to the pure statistics of each player's career. BPM, or Box Plus/Minus, is another statistic we decided to include as it is another option for a calculated box score based metric (). It is anothere weighted estimate of a player's contribution to their team. Where BPM just looks at how much a player helps or hurts their team when they are on the court, VORP takes that and weighs by the number of minutes the player is on the court for, with the idea that better players are playing more minutes. We urge you to take a strong look at the VORP and BPM tabs especially if you are less familiar with basketball. You are also welcome to look into the purer career statistics we have included, nobably field goal percentage, PPG, and TRB. 

```{r, echo = FALSE}
shinyApp(
  ui = navbarPage(
  theme = shinytheme("yeti"),
  title = "NBA Success",
  
  tabPanel(
    title = "VORP",
    fluidPage(
      fluidRow(
        mainPanel( width = 12,
                   plotlyOutput(outputId = "vorp", height = "350px", width = "100%"))
      )
    )
  ),
  
  tabPanel(
    title = "BPM",
    fluidPage(
      fluidRow(
        mainPanel( width = 12,
                   plotlyOutput(outputId = "bpm", height = "350px", width = "100%")
          
        )
      )
    )
  ),
  
  tabPanel(
    title = "FGpct",
    fluidPage(
      fluidRow(
        mainPanel(width = 12,
                  plotlyOutput(outputId = "fgp", height = "350px", width = "100%")
          
        )
      )
    )
  ),
  
  tabPanel(
    title = "PTS",
    fluidPage(
      fluidRow(
        mainPanel(width = 12,
                  plotlyOutput(outputId = "pts", height = "350px", width = "100%")
          
        )
      )
    )
  ),
  
  tabPanel(
    title = "TRB",
    fluidPage(
      fluidRow(
        mainPanel(width = 12,
                  plotlyOutput(outputId = "trb", height = "350px", width = "100%")
          
        )
      )
    )
  ),
  

  hr(),
  p(em("Developed by Emma Gardecki and Eric Ingram")),
  p(em("Updated May 17, 2021"))
),

server = function(input, output) {
  #vorp
  output$vorp <- renderPlotly({
    plot_ly( draft, x = ~Years, y = ~VORP, type = "scatter", mode = "markers", name = ~Player) %>%
      add_trace(draft, color = ~as.factor(Draft_Year)) %>%
      layout(title = "Career Success - Value Over Replacement Player", showlegend = FALSE)
  })
  
  #bpm
  output$bpm <- renderPlotly({
    plot_ly( draft, x = ~Years, y = ~BPM, type = "scatter", mode = "markers", name = ~Player) %>%
      add_trace(draft, color = ~as.factor(Draft_Year)) %>%
      layout(title = "Career Success - Box Plus/Minus", showlegend = FALSE)
  })
  
  #fgp
  output$fgp <- renderPlotly({
    plot_ly( draft, x = ~Years, y = ~FGpct, type = "scatter", mode = "markers", name = ~Player) %>%
      add_trace(draft, color = ~as.factor(Draft_Year)) %>%
      layout(title = "Career Success - Field Goal %", showlegend = FALSE)
  })
  
  #pts
  output$pts <- renderPlotly({
    plot_ly( draft, x = ~Years, y = ~PTS, type = "scatter", mode = "markers", name = ~Player) %>%
      add_trace(draft, color = ~as.factor(Draft_Year)) %>%
      layout(title = "Career Success - Points per Game", showlegend = FALSE)
  })
  
  #trb
  output$trb <- renderPlotly({
    plot_ly( draft, x = ~Years, y = ~TRB, type = "scatter", mode = "markers", name = ~Player) %>%
      add_trace(draft, color = ~as.factor(Draft_Year)) %>%
      layout(title = "Career Success - Rebounds per Game", showlegend = FALSE)
  })
  
}
)
```


## Networks
```{r, warning = FALSE}
p0 <- c("Rajon Rondo", "Kyle Lowry", "JJ Redick", "Paul Millsap", "LaMarcus Aldridge", "Rudy Gay")
set.seed(0037)
nbaRR <- players %>%
  select(player, Team, Year) %>%
  filter( player %in% p0)

RR <- graph_from_data_frame(nbaRR, directed = TRUE)

RRnet <- ggnetwork( RR )
RRnet$tooltip <- paste0("Team = ", RRnet$name)
  
RRgg <- ggplot(data = RRnet
       , aes(x = x, y = y, xend = xend, yend = yend, tooltip = tooltip)) +
  geom_edges(color = "green") +
  geom_nodes(color = "gold", size = 4) +
  theme_blank() +
  geom_nodetext(aes(label = name), nudge_x = .01, nudge_y = .03) +
  geom_point_interactive(size=2) + 
  labs(
    title = "Connectivity"
  )

# htmlwidget call
# ggiraph(code = {print(gg_point_4)})

girafe(ggobj = RRgg, 
  options = list(
    opts_sizing(width = .7),
    # opts_hover_inv(css = "opacity:0.1;"),
    # opts_hover(css = "fill:red;"),
    opts_toolbar(position = "bottomright") )
  )
```


```{r}
set.seed(0037)
nbaRR <- players %>%
  select(player, Team, Year) %>%
  filter( player %in% p0)

RR <- graph_from_data_frame(nbaRR, directed = TRUE)

RRnet <- ggnetwork( RR )
RRnet$tooltip <- paste0("Team = ", RRnet$name)
  
RRgg <- ggplot(data = RRnet
       , aes(x = x, y = y, xend = xend, yend = yend, tooltip = tooltip)) +
  geom_edges(color = "green") +
  geom_nodes(color = "gold", size = 4) +
  theme_blank() +
  geom_nodetext(aes(label = name), nudge_x = .01, nudge_y = .03) +
  geom_point_interactive(size=2) + 
  labs(
    title = "Connectivity"
  )

# htmlwidget call
# ggiraph(code = {print(gg_point_4)})

girafe(ggobj = RRgg, 
  options = list(
    opts_sizing(width = .7),
    # opts_hover_inv(css = "opacity:0.1;"),
    # opts_hover(css = "fill:red;"),
    opts_toolbar(position = "bottomright") )
  )
```





# Conclusion
## Limitations
* No data on AAU teams
  + Many players played on AAU or other similar High School level teams outside of their actual high school. It is certain that we missed some connections there, but this data is not readily available.

* No data on International Teams
  + Many players played internationally before coming to the NBA. We have no readily available data for those teams so connections were again missed. International players, specifically, may have also not attended High School and College in the U.S. and are therefore excluded from those respective networks.  

* One-team players
  + Some players have played the majority (or the entirety) of their careers with a single team. This means they have less connections, but they could still be extremely successful. A network analysis could still give us useful information about these players if we look at the network of teammates they had over time but this analysis is beyond the scope of this blog.

## Conclusion


## Future Research


# References
* http://curleylab.psych.columbia.edu/netviz/netviz1.html#/45
* https://www.basketball-reference.com/about/bpm2.html
* https://www.reddit.com/r/nba/comments/7rq7t4/how_is_the_advanced_stat_vorpvalue_over/
* https://www.reddit.com/r/nba/comments/3bkfxj/graph_average_number_of_trades_per_team_per_year/

Let's clean up the format of that output:

```{r pretty, echo=FALSE, warning=FALSE, message=FALSE}
library(kableExtra)
summary(cars) %>%
  kable(col.names = c("Speed", "Distance")
        , row.names = F) %>%
  kable_styling(bootstrap_options = "striped"
                , full_width = F) %>%
  row_spec(0, bold = T, underline = T) %>%
  column_spec(1:2, width = "1.5in") 
```


Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.


## Including links and images

You can include [Links](https://www.datadreaming.org/post/r-markdown-theme-gallery/) and images ![team logo](https://raw.githubusercontent.com/stat231-s21/Blog-Team-Basketball/main/images/s2g6-sports.jpg)

You can embed a gif.

![pugs](https://media.giphy.com/media/XHVmD4RyXgSjd8aUMb/giphy.gif)


# You can even create tabs if you want! {.tabset .tabset-fade .tabset-pills}

## Bulleted list

You can make a bulleted list like this:

- item 1
- item 2
- item 3


## Numbered list

You can make a numbered list like this

1. First thing I want to say
2. Second thing I want to say
3. Third thing I want to say

